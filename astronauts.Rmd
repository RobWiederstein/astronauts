---
title: "Astronauts"
output: html_notebook
---

```{r astronaut-import-libraries, include = F}
x <- c("igraph", "tidyverse", "kableExtra")
sapply(x, library, character.only = T)
```

```{r astronaut-import-data}
input <- "./data/astronauts.csv"
df <- data.table::fread(input = input)
```

This project was based on the astronaut [dataset](https://www.kaggle.com/jessemostipak/astronaut-database) at kaggle. It was downloaded and imported. The dataset contains all flights into space and has descriptive informaton on the flight and the basic biographical information of the astronauts on the flight.  There were `r nrow(df)` rows and `r ncol(df)` columns. The first mission was in `r min(df$year_of_mission)` and the dataset includes the missions through `r max(df$year_of_mission)`.

# Preliminaries

## Missingness

Let's check for missingness. `r length(which(is.na(df) == T))` values are missing.  Subsetting to only the rows that contain a missing value yields the dataframe below.

```{r astro-subset-nas}
df.na <- df[!complete.cases(df), ]
df.na
```

Also, let's understand what values in the variables are missing and see if there is any discernible pattern.

```{r astro-amelia-missmap}
Amelia::missmap(df.na, 
                margins = c(10, 10),
                main = "Astronauts Missing Data")
```

## Unique values

Also, let's count the unique values within each column to identify potential factor variables. The `id` field is clearly a unique identifier for each row. It also appears that each astronaut has a unique identifier in the `number` field in addition to the `name` field.

```{r astro-unique-values}
rev(sort(apply(df, 2, function(x) length(unique(x))))) 
```

## Variable Types

```{r astro-column-classes}
class(df$id)
table(unlist(lapply(df, class)))
```

## Summary

```{r}
my.summary <- do.call(cbind, lapply(df, summary, digits = 2))
my.summary[1:5, 1:5]
```

## Challenges

There was some difficulty in the data which was discovered when creating a network analysis.  The names were problematic. "Aleksandrov, Aleksandr", a Russian astronaut, is the same person but appears in the astronaut subset twice.  The other issue is that two astronauts have been assigned the number "385": Yuri Baturin and Pedro Duque.  This challenge will be set aside for the time being.

```{r astronaut-subset-name}
df2 <- df[, c(2, 4)] #subset main df to just names and number
df2 <- dplyr::distinct(df2) #filter to unique/distinct values 564
length(unique(df2$name)) #564 astronauts
length(unique(df2$number))#564 unique numbers
#one astronaut is included in the names column twice--it is the same person
duplicate.name <- df2$name[duplicated(df2$name)] #"Aleksandrov, Aleksandr"
df2[grep("Aleksandrov, Aleksandr", df2$name)]
#two astronauts have the same number
duplicate.number <- df2$number[duplicated(df2$number)]
df[which(df$number == duplicate.number)]
```

```{r astro-corr-numeric}
df3 <- dplyr::select_if(df, is.numeric)
df3 <- dplyr::select(df3, -id, -number, -mission_number)
res <- cor(df3)
res <- round(res, 2)
library(corrplot)
col<- colorRampPalette(c("blue", "white", "red"))(20)
heatmap(x = res, col = col, 
        symm = TRUE, 
        margins = c(10, 10),
        main = "Numeric Astonaut Variables")
```

```{r astro-univariate-distributions}
df4 <- dplyr::select_if(df, is.numeric)
df4 <- dplyr::select(df4, hours_mission, total_hrs_sum)
df4 <- tidyr::gather(df4)
library(ggplot2)
p <- ggplot(df4, aes(value, group = key, colour = key))
p <- p + geom_boxplot()
p
```

```{r}
df$age <- df$year_of_mission - df$year_of_birth
df5 <-
        df %>%
        select(name, age, sex) 
p <- ggplot(df5, aes(age))
p <- p + geom_histogram(binwidth = 1)
p <- p + facet_grid(. ~ sex)
p
```


```{r astro-space-flights}
df$num <- 1
df6 <-
        df %>%
        dplyr::filter(nationality %in% c("U.S.S.R/Russia", "U.S.")) %>%
        group_by(year_of_mission, nationality) %>%
        summarize(flights = sum(num))
colnames(df6)[1] <- "year"
p <- ggplot(df6, aes(year, flights, group = nationality, color = nationality))
p <- p + geom_line()
p <- p + geom_point(size = 1)
p <- p + ggtitle(paste("Annual Flights U.S. v. Russia 1961 - 2019"))
p
```


```{r astro-top-10-space-time}
df7 <-
        df %>%
        select(name, nationality, sex, year_of_birth, total_hrs_sum) %>%
        arrange(-total_hrs_sum) %>%
        distinct() %>%
        dplyr::slice_head(n = 10)
df7
```

## Social Nework Analysis

```{r}
space_race <- min(df$year_of_mission): 1969
df.1 <- dplyr::filter(df, year_of_mission %in% space_race)

df.2 <-
        df.1 %>%  
        select(mission_title, name) %>%
        inner_join(., select(., mission_title, name), by = "mission_title") %>%
        rename(name1 = name.x, name2 = name.y) %>%
        dplyr::filter(name1 != name2) %>%
        arrange(mission_title) %>% 
        unique

#save edge list
df.3 <- dplyr::select(df.2, name1, name2,  mission_title)
df.4 <- as.matrix(df.3[, 1:2])
g <- graph_from_data_frame(df.3,
                           directed = FALSE)
g1 <- simplify(g)
plot(g1,
     vertex.label = NA)

```

```{r astro-space-race-nodes, fig.asp = .66}
#nodes
nodes <- tibble(name = unique(c(df.3$name1, df.3$name2)))
nodes.1 <- dplyr::left_join(nodes, df.1, by = "name")
nodes.1 <- nodes.1[-which(duplicated(nodes.1$name) == TRUE), ]
#add nationality
nodes.1$nationality_col <- "blue"
nodes.1$nationality_col[grep("Russia", nodes.1$nationality)] <- "red"
#add lastname
nodes.1$last_name <- gsub(",", "", word(nodes.1$name))
#graph
g <- graph_from_data_frame(df.3,
                           directed = FALSE,
                           vertices = nodes.1)
g1 <- simplify(g)
par(mar = c(1, 1, 1, 1))
set.seed(123)
plot(g1,
     layout = layout_with_fr,
     vertex.color = V(g1)$nationality_col,
     vertex.size = V(g1)$total_number_of_missions * 1.75,
     vertex.label = V(g1)$last_name,
     vertex.label.dist = 1.4,
     vertex.label.cex = 1.25,
     asp = 0,
     main = "U.S. vs. Russia Space Race"
     )

```

```{r}
x <- tkplot(g1,
     layout = layout_with_fr,
     vertex.color = V(g1)$nationality_col,
     vertex.size = V(g1)$total_number_of_missions * 2,
     vertex.label = V(g1)$last_name,
     vertex.label.dist = 1.4,
     vertex.label.cex = 1.25,
     asp = 0,
     main = "U.S. vs. Russia Space Race"
     )
#Here: Move nodes within the tkplot window to a layout you like!
coords01 <- tkplot.getcoords(x)
filename <- "./astronauts_coords_via_tkplot.jpeg"
jpeg(filename = filename, width = 6, height = 4, units = "in", quality = 95, res = 300, type = "cairo")
par(mar = c(1, 0, 1, 0))
plot(g1,
        layout = coords01,
        main = "U.S. vs. Russia Space Race",
        vertex.color = V(g1)$nationality_col,
        vertex.size = V(g1)$total_number_of_missions * 2,
        vertex.label = V(g1)$last_name,
        vertex.label.dist = 1.4,
        vertex.label.cex = 1.25,
        asp = 0
     )
dev.off()

```

